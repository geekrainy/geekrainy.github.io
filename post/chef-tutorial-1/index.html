<!DOCTYPE html><html><head><meta charset="utf-8"><title>Chef 自动化运维：Chef 的安装 | 雨落</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="安装准备准备三台服务器，分别用作 Chef Server、Chef DK、Chef Client 的安装使用。 在三台服务器中，添加以下 hosts: 12345vim &#x2F;etc&#x2F;hosts192.168.221.89 chef-server.geekrainy.local chef-server192.168.221.90 chef-dk.geekrainy.local chef-dk192.1"><meta property="og:type" content="article"><meta property="og:title" content="Chef 自动化运维：Chef 的安装"><meta property="og:url" content="https://rainylog.com/post/chef-tutorial-1/index.html"><meta property="og:site_name" content="雨落"><meta property="og:description" content="安装准备准备三台服务器，分别用作 Chef Server、Chef DK、Chef Client 的安装使用。 在三台服务器中，添加以下 hosts: 12345vim &#x2F;etc&#x2F;hosts192.168.221.89 chef-server.geekrainy.local chef-server192.168.221.90 chef-dk.geekrainy.local chef-dk192.1"><meta property="og:locale"><meta property="article:published_time" content="2017-12-25T02:02:08.000Z"><meta property="article:modified_time" content="2020-12-29T13:35:51.525Z"><meta property="article:author" content="Rainy"><meta property="article:tag" content="Chef"><meta property="article:tag" content="运维"><meta property="article:tag" content="DevOps"><meta name="twitter:card" content="summary"><link rel="icon" href="/favicon.png"><link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99171848-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-99171848-1")</script><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"><meta name="generator" content="Hexo 5.1.0"><link rel="alternate" href="/atom.xml" title="雨落" type="application/atom+xml">
</head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">雨 </span><span class="b">落 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-chef-tutorial-1" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">Chef 自动化运维：Chef 的安装</h1><div class="article-meta">Posted on <time class="article-time" datetime="2017-12-25T02:02:08.000Z" itemprop="datePublished">Dec 25, 2017</time></div></header><div class="article-entry" itemprop="articleBody"><h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><p>准备三台服务器，分别用作 Chef Server、Chef DK、Chef Client 的安装使用。</p><p>在三台服务器中，添加以下 hosts:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.221.89 chef-server.geekrainy.local chef-server</span><br><span class="line">192.168.221.90 chef-dk.geekrainy.local chef-dk</span><br><span class="line">192.168.221.91 chef-client.geekrainy.local chef-client</span><br></pre></td></tr></table></figure><h2 id="安装-Chef-Server"><a href="#安装-Chef-Server" class="headerlink" title="安装 Chef Server"></a>安装 Chef Server</h2><p>访问 Chef <a target="_blank" rel="noopener" href="https://downloads.chef.io/">下载页面</a>，选择合适的发行版和系统架构，进行下载安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://packages.chef.io/files/stable/chef-server/12.17.15/el/7/chef-server-core-12.17.15-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>执行安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh chef-server*.rpm</span><br></pre></td></tr></table></figure><p>执行配置（此过程会将需要的附属套件一并安装）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl reconfigure</span><br></pre></td></tr></table></figure><p>检查组件状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl status</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run: bookshelf: (pid 1246) 5195s; run: log: (pid 1243) 5195s</span><br><span class="line">run: nginx: (pid 8394) 2240s; run: log: (pid 1262) 5195s</span><br><span class="line">run: oc_bifrost: (pid 1253) 5195s; run: log: (pid 1252) 5195s</span><br><span class="line">run: oc_id: (pid 1264) 5195s; run: log: (pid 8281) 2241s</span><br><span class="line">run: opscode-erchef: (pid 8285) 2240s; run: log: (pid 1244) 5195s</span><br><span class="line">run: opscode-expander: (pid 1251) 5195s; run: log: (pid 1247) 5195s</span><br><span class="line">run: opscode-solr4: (pid 1259) 5195s; run: log: (pid 1258) 5195s</span><br><span class="line">run: postgresql: (pid 1275) 5195s; run: log: (pid 1269) 5195s</span><br><span class="line">run: rabbitmq: (pid 1257) 5195s; run: log: (pid 1256) 5195s</span><br><span class="line">run: redis_lb: (pid 5711) 2271s; run: log: (pid 1250) 5195s</span><br></pre></td></tr></table></figure><h3 id="创建管理员用户和组织"><a href="#创建管理员用户和组织" class="headerlink" title="创建管理员用户和组织"></a>创建管理员用户和组织</h3><p>以下命令创建过程中，会默认创建私钥，需要保存至安全的地方：</p><blockquote><p>User Name: admin</p><p>First Name: admin</p><p>Last Name: admin</p><p>Email: <a href="mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#x67;&#101;&#x65;&#x6b;&#x72;&#97;&#105;&#x6e;&#x79;&#46;&#x6c;&#x6f;&#x63;&#97;&#x6c;">&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#x67;&#101;&#x65;&#x6b;&#x72;&#97;&#105;&#x6e;&#x79;&#46;&#x6c;&#x6f;&#x63;&#97;&#x6c;</a></p><p>Password: password</p><p>File Name: admin.pem</p><p>Path: /etc/chef</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl user-create admin admin admin admin@geekrainy.local password -f /etc/chef/admin.pem</span><br></pre></td></tr></table></figure><p>原始命令参考：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl user-create USER_NAME FIRST_NAME LAST_NAME EMAIL &#x27;PASSWORD&#x27; -f PATH_FILE_NAME</span><br></pre></td></tr></table></figure><p>开始创建组织：</p><blockquote><p>Short Name: geekrainy</p><p>Full Organization Name: GeekRainy, Inc</p><p>Association User: admin （设置 admin 用户为安全组用户）</p><p>Filename: geekrainy-validator.pem</p><p>Path: /etc/chef</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl org-create geekrainy &quot;GeekRainy, Inc&quot; --association_user admin -f /etc/chef/geekrainy-validator.pem</span><br></pre></td></tr></table></figure><p>原始命令参考：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl org-create short_name &#x27;full_organization_name&#x27; --association_user user_name --filename ORGANIZATION-validator.pem</span><br></pre></td></tr></table></figure><h3 id="端口配置"><a href="#端口配置" class="headerlink" title="端口配置"></a>端口配置</h3><p>Chef Server 要求开放下列端口通过防火墙，但是在此处我们只需要开放 80 和 443 端口。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone public --add-service http</span><br><span class="line">firewall-cmd --permanent --zone public --add-service https</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2 id="安装-Chef-Workstation"><a href="#安装-Chef-Workstation" class="headerlink" title="安装 Chef Workstation"></a>安装 Chef Workstation</h2><p>下载安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://packages.chef.io/files/stable/chefdk/2.4.17/el/7/chefdk-2.4.17-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh chefdk-*.rpm</span><br></pre></td></tr></table></figure><p>验证安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef verify</span><br></pre></td></tr></table></figure><p>确保 ruby 环境安装完毕：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which ruby</span><br></pre></td></tr></table></figure><p>配置环境变量：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;eval &quot;$(chef shell-init bash)&quot;&#x27; &gt;&gt; ~/.bash_profile</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure><h3 id="配置-Chef-仓库"><a href="#配置-Chef-仓库" class="headerlink" title="配置 Chef 仓库"></a>配置 Chef 仓库</h3><p>确保安装了 git，之后使用 chef 命令初始化一个仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef generate repo chef-repo</span><br></pre></td></tr></table></figure><p>配置 git 提交用户和邮箱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;admin&quot;</span><br><span class="line">git config --global user.email &quot;admin@geekrainy.local&quot;</span><br></pre></td></tr></table></figure><p>初始化仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd chef-repo</span><br><span class="line">git init</span><br></pre></td></tr></table></figure><p>创建 .chef 目录，它将用来保存 Chef Server 创建的私钥，因此忽略该目录的版本跟踪：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;.chef&#x27; &gt;&gt; ~/chef-repo/.gitignore</span><br></pre></td></tr></table></figure><p>初始化提交：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd chef-repo</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;initial commit&quot;</span><br></pre></td></tr></table></figure><p>将服务器生成的 key 保存至 .chef 文件夹：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -pr root@chef-server:/etc/chef/admin.pem ~/chef-repo/.chef/</span><br><span class="line">scp -pr root@chef-server:/etc/chef/geekrainy-validator.pem ~/chef-repo/.chef/</span><br></pre></td></tr></table></figure><h3 id="关于-Knife"><a href="#关于-Knife" class="headerlink" title="关于 Knife"></a>关于 Knife</h3><p>Knife 是一个在 Chef 仓库和 Chef Server 之间进行交互的命令，在使用这个命令之前，需要<del>新建一个 knife.rb 配置文件</del>新建一个 config.rb 配置文件（在版本 12 中，用 config.rb 替换了 knife.rb，参见 <a target="_blank" rel="noopener" href="https://docs.chef.io/config_rb.html%EF%BC%89%E3%80%82">https://docs.chef.io/config_rb.html）。</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/chef-repo/.chef/knife.rb</span><br></pre></td></tr></table></figure><p>在文件中添加如下信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">current_dir = File.dirname(__FILE__)</span><br><span class="line">log_level                :info</span><br><span class="line">log_location             STDOUT</span><br><span class="line">node_name                &quot;admin&quot;</span><br><span class="line">client_key               &quot;#&#123;current_dir&#125;/admin.pem&quot;</span><br><span class="line">validation_client_name   &quot;geekrainy-validator&quot;</span><br><span class="line">validation_key           &quot;#&#123;current_dir&#125;/geekrainy-validator.pem&quot;</span><br><span class="line">chef_server_url          &quot;https://chef-server.geekrainy.local/organizations/geekrainy&quot;</span><br><span class="line">syntax_check_cache_path  &quot;#&#123;ENV[&#x27;HOME&#x27;]&#125;/.chef/syntaxcache&quot;</span><br><span class="line">cookbook_path            [&quot;#&#123;current_dir&#125;/../cookbooks&quot;]</span><br></pre></td></tr></table></figure><blockquote><p>node_name: 用户名应该与 Chef Server 创建的管理员用户名相匹配</p><p>client_key: 保存 Chef Server 创建的用户私钥的路径</p><p>validation_client_name: 组织的短用户名加 -validator</p><p>validation_key: Chef Server 创建的组织验证私钥路径</p><p>chef_server_url: 同 hostname 配置的一致</p></blockquote><p>测试 Knife 命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/chef-repo</span><br><span class="line">knife client list</span><br></pre></td></tr></table></figure><p>得到如下错误：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ERROR: SSL Validation failure connecting to host: chef-server.geekrainy.local - SSL_connect returned=1 errno=0 state=error: certificate verify failed</span><br><span class="line">ERROR: Could not establish a secure connection to the server.</span><br><span class="line">Use `knife ssl check` to troubleshoot your SSL configuration.</span><br><span class="line">If your Chef Server uses a self-signed certificate, you can use</span><br><span class="line">`knife ssl fetch` to make knife trust the server&#x27;s certificates.</span><br><span class="line"></span><br><span class="line">Original Exception: OpenSSL::SSL::SSLError: SSL Error connecting to https://chef-server.geekrainy.local/organizations/geekrainy/clients - SSL_connect returned=1 errno=0 state=error: certificate verify failed</span><br></pre></td></tr></table></figure><p>从 Chef Server 获取证书：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">knife ssl fetch</span><br><span class="line"></span><br><span class="line">WARNING: Certificates from chef-server.geekrainy.local will be fetched and placed in your trusted_cert</span><br><span class="line">directory (/root/chef-repo/.chef/trusted_certs).</span><br><span class="line"></span><br><span class="line">Knife has no means to verify these are the correct certificates. You should</span><br><span class="line">verify the authenticity of these certificates after downloading.</span><br><span class="line"></span><br><span class="line">Adding certificate for chef-server_geekrainy_local in /root/chef-repo/.chef/trusted_certs/chef-server_geekrainy_local.crt</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>该证书将被保存至 <code>.chef/trusted_certs</code> 文件夹下。</p><p>此时再次执行命令验证：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">knife client list</span><br><span class="line">geekrainy-validator</span><br></pre></td></tr></table></figure><p>可以得到结果，至此已经完成了搭建。</p><h3 id="修改-hostname-的注意事项"><a href="#修改-hostname-的注意事项" class="headerlink" title="修改 hostname 的注意事项"></a>修改 hostname 的注意事项</h3><p>若在安装 Chef Server 后，重新修改了 Chef Server 的 hostname，在获取 Chef Server 证书的时候是基于之前的主机名和域名配置的，因而需要重新执行配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/opscode/chef-server.rb</span><br></pre></td></tr></table></figure><p>添加如下配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server_name = &quot;chef-server.geekrainy.local&quot;</span><br><span class="line">api_fqdn server_name</span><br></pre></td></tr></table></figure><p>这里的 chef-server.geekrainy.local 为更改后的主机名配置，当然，同 knife.rb 中的地址也是一致的。执行 Chef Server 的重新配置命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-ctl reconfigure</span><br></pre></td></tr></table></figure><p>随后，重新执行上述步骤即可获得正确的 crt 证书。</p><blockquote><p>关于 chef-server.rb 的配置，可以参考说明：<a target="_blank" rel="noopener" href="https://docs.chef.io/config_rb_server.html">https://docs.chef.io/config_rb_server.html</a></p></blockquote><h2 id="配置-Chef-Client"><a href="#配置-Chef-Client" class="headerlink" title="配置 Chef Client"></a>配置 Chef Client</h2><p>用 knife 命令来创建一个新的节点，即在目标主机安装 Chef Client 与 Chef Server 相关联：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife bootstrap chef-client.geekriany.local -x root -P password --sudo</span><br></pre></td></tr></table></figure><p>如果需要使用 sudo 命令来获得管理员权限，则需要添加 <code>--sudo</code> 参数，在此处使用 CentOS 7，不需要此参数。</p><p>以上参数的解释：</p><blockquote><p>-x ssh 用户名</p><p>-P ssh 密码</p><p>-p ssh 端口</p></blockquote><p>执行后可以看到如下输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Connecting to chef-client.geekrainy.local</span><br><span class="line">chef-client.geekrainy.local -----&gt; Installing Chef Omnibus (-v 13)</span><br><span class="line">chef-client.geekrainy.local downloading https://omnitruck-direct.chef.io/chef/install.sh</span><br><span class="line">chef-client.geekrainy.local   to file /tmp/install.sh.3511/install.sh</span><br><span class="line">chef-client.geekrainy.local trying wget...</span><br><span class="line">chef-client.geekrainy.local el 7 x86_64</span><br><span class="line">chef-client.geekrainy.local Getting information for chef stable 13 for el...</span><br><span class="line">chef-client.geekrainy.local downloading https://omnitruck-direct.chef.io/stable/chef/metadata?v=13&amp;p=el&amp;pv=7&amp;m=x86_64</span><br><span class="line">chef-client.geekrainy.local   to file /tmp/install.sh.3528/metadata.txt</span><br><span class="line">chef-client.geekrainy.local trying wget...</span><br><span class="line">chef-client.geekrainy.local sha1	037a61a5d9c89d9b71d4c4f6256f45ed422a73ee</span><br><span class="line">chef-client.geekrainy.local sha256	18826690ac2c7e5f16a21d898ed77be7d78fd2d84bc2a71b4506ee480876bc4b</span><br><span class="line">chef-client.geekrainy.local url	https://packages.chef.io/files/stable/chef/13.6.4/el/7/chef-13.6.4-1.el7.x86_64.rpm</span><br><span class="line">chef-client.geekrainy.local version	13.6.4</span><br><span class="line">chef-client.geekrainy.local downloaded metadata file looks valid...</span><br><span class="line">chef-client.geekrainy.local downloading https://packages.chef.io/files/stable/chef/13.6.4/el/7/chef-13.6.4-1.el7.x86_64.rpm</span><br><span class="line">chef-client.geekrainy.local   to file /tmp/install.sh.3528/chef-13.6.4-1.el7.x86_64.rpm</span><br><span class="line">chef-client.geekrainy.local trying wget...</span><br><span class="line">chef-client.geekrainy.local Comparing checksum with sha256sum...</span><br><span class="line">chef-client.geekrainy.local Installing chef 13</span><br><span class="line">chef-client.geekrainy.local installing with rpm...</span><br><span class="line">chef-client.geekrainy.local warning: /tmp/install.sh.3528/chef-13.6.4-1.el7.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 83ef826a: NOKEY</span><br><span class="line">chef-client.geekrainy.local Preparing...                          ################################# [100%]</span><br><span class="line">chef-client.geekrainy.local Updating / installing...</span><br><span class="line">chef-client.geekrainy.local    1:chef-13.6.4-1.el7                ################################# [100%]</span><br><span class="line">chef-client.geekrainy.local Thank you for installing Chef!</span><br><span class="line">chef-client.geekrainy.local Starting the first Chef Client run...</span><br><span class="line">chef-client.geekrainy.local Starting Chef Client, version 13.6.4</span><br><span class="line">chef-client.geekrainy.local Creating a new client identity for chef-client.geekrainy.local using the validator key.</span><br><span class="line">chef-client.geekrainy.local resolving cookbooks for run list: []</span><br><span class="line">chef-client.geekrainy.local Synchronizing Cookbooks:</span><br><span class="line">chef-client.geekrainy.local Installing Cookbook Gems:</span><br><span class="line">chef-client.geekrainy.local Compiling Cookbooks...</span><br><span class="line">chef-client.geekrainy.local [2017-12-26T10:13:45+08:00] WARN: Node chef-client.geekrainy.local has an empty run list.</span><br><span class="line">chef-client.geekrainy.local Converging 0 resources</span><br><span class="line">chef-client.geekrainy.local </span><br><span class="line">chef-client.geekrainy.local Running handlers:</span><br><span class="line">chef-client.geekrainy.local Running handlers complete</span><br><span class="line">chef-client.geekrainy.local Chef Client finished, 0/0 resources updated in 20 seconds</span><br></pre></td></tr></table></figure><p>上述输出证明节点已经配置完毕，验证：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife node list</span><br></pre></td></tr></table></figure><p>返回如下结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-client.geekrainy.local</span><br></pre></td></tr></table></figure><p>查看该节点的详情：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@chef-dk chef-repo]# knife client show chef-client.geekrainy.local</span><br><span class="line">admin:     false</span><br><span class="line">chef_type: client</span><br><span class="line">name:      chef-client.geekrainy.local</span><br><span class="line">validator: false</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a target="_blank" rel="noopener" href="https://www.itzgeek.com/how-tos/linux/centos-how-tos/setup-chef-12-centos-7-rhel-7.html">https://www.itzgeek.com/how-tos/linux/centos-how-tos/setup-chef-12-centos-7-rhel-7.html</a></li><li><a target="_blank" rel="noopener" href="https://gist.github.com/KingPin/8542999">https://gist.github.com/KingPin/8542999</a></li><li><a target="_blank" rel="noopener" href="https://docs.chef.io/config_rb_server.html">https://docs.chef.io/config_rb_server.html</a></li><li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-a-chef-server-workstation-and-client-on-ubuntu-vps-instances">https://www.digitalocean.com/community/tutorials/how-to-install-a-chef-server-workstation-and-client-on-ubuntu-vps-instances</a></li></ul><p>-EOF-</p><div class="article-copyright"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external"><span class="icon icon-creative-commons"></span> <span>本博客所有文章除特别声明外，均采用 CC BY-NC-ND 4.0 许可协议。转载请注明出处！</span> </a><a href="https://rainylog.com">&copy; 雨落</a></div></div><div class="article-tags"><a class="tag-none-link" href="/tags/Chef/" rel="tag">Chef</a><a class="tag-none-link" href="/tags/DevOps/" rel="tag">DevOps</a><a class="tag-none-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></div><nav class="article-nav clearfix"><a href="/post/chef-tutorial-2/" class="article-nav-newer"><div class="article-nav-title">Chef 自动化运维：初探 cookbook</div></a><a href="/post/install-nfs-on-centos/" class="article-nav-older"><div class="article-nav-title">CentOS 配置部署 NFS</div></a></nav><section id="comments" class="white-box"></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="https://rainylog.com">雨落</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a target="_blank" href="https://hexo.io/" rel="external noopener">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix show" style="display:block"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc show" style="display:block"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">安装准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Chef-Server"><span class="toc-number">2.</span> <span class="toc-text">安装 Chef Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E7%BB%87"><span class="toc-number">2.1.</span> <span class="toc-text">创建管理员用户和组织</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">端口配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Chef-Workstation"><span class="toc-number">3.</span> <span class="toc-text">安装 Chef Workstation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Chef-%E4%BB%93%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">配置 Chef 仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-Knife"><span class="toc-number">3.2.</span> <span class="toc-text">关于 Knife</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-hostname-%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">3.3.</span> <span class="toc-text">修改 hostname 的注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Chef-Client"><span class="toc-number">4.</span> <span class="toc-text">配置 Chef Client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="site-bio" style="display:none"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.gif"></div><div class="info"><a class="name dark-btn" href="/about">Rainy</a></div><div class="info"><span class="item desc">沉淀，分享。</span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto://geekrainy@gmail.com" class="email" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/geekrainy" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://weibo.com/geekrainy" class="weibo" target="_blank" rel="external"><span class="icon icon-weibo"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="rainylog",AZURE_INDEX_NAME="rainylog",AZURE_QUERY_KEY="FDEE6CFE3AB9A25E574BBCB873B29595",BAIDU_API_ID="",SEARCH_SERVICE="azure"</script><script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!0,notify:!0,appId:"H90zpiwhe0XxV8Kb8n6BplHo-MdYXbMMI",appKey:"974axFeQbAqLnxwJIRgc1xHa",placeholder:"Just go go",avatar:"retro",meta:guest,pageSize:10,visitor:!0})</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>