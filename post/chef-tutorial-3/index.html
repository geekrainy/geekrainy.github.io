<!DOCTYPE html><html><head><meta charset="utf-8"><title>Chef 自动化运维：开始“烹饪” | 雨落</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="在 Chef Workstation 上创建了一个  cookbook 之后，我们执行以下命令来进行测试： 1chef-client --local-mode --override-runlist first_cookbook  这将在本机执行 cookbook，现在来将 first_cookbook 分发到节点上。 上传 cookbookChef Workstation 进行 cookbook"><meta property="og:type" content="article"><meta property="og:title" content="Chef 自动化运维：开始“烹饪”"><meta property="og:url" content="https://rainylog.com/post/chef-tutorial-3/index.html"><meta property="og:site_name" content="雨落"><meta property="og:description" content="在 Chef Workstation 上创建了一个  cookbook 之后，我们执行以下命令来进行测试： 1chef-client --local-mode --override-runlist first_cookbook  这将在本机执行 cookbook，现在来将 first_cookbook 分发到节点上。 上传 cookbookChef Workstation 进行 cookbook"><meta property="og:locale"><meta property="og:image" content="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-1.png"><meta property="og:image" content="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-2.png"><meta property="og:image" content="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-3.png"><meta property="article:published_time" content="2017-12-28T01:57:59.000Z"><meta property="article:modified_time" content="2020-12-29T13:35:51.525Z"><meta property="article:author" content="Rainy"><meta property="article:tag" content="Chef"><meta property="article:tag" content="DevOps"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-1.png"><link rel="icon" href="/favicon.png"><link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99171848-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-99171848-1")</script><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"><meta name="generator" content="Hexo 5.1.0"><link rel="alternate" href="/atom.xml" title="雨落" type="application/atom+xml">
</head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">雨 </span><span class="b">落 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-chef-tutorial-3" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">Chef 自动化运维：开始“烹饪”</h1><div class="article-meta">Posted on <time class="article-time" datetime="2017-12-28T01:57:59.000Z" itemprop="datePublished">Dec 28, 2017</time></div></header><div class="article-entry" itemprop="articleBody"><p>在 Chef Workstation 上创建了一个 cookbook 之后，我们执行以下命令来进行测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-client --local-mode --override-runlist first_cookbook</span><br></pre></td></tr></table></figure><p>这将在本机执行 cookbook，现在来将 first_cookbook 分发到节点上。</p><h2 id="上传-cookbook"><a href="#上传-cookbook" class="headerlink" title="上传 cookbook"></a>上传 cookbook</h2><p>Chef Workstation 进行 cookbook 的编写测试之后，需要将其上传到 Chef Server 才能分发到各个节点，执行以下命令将 cookbook 上传：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife cookbook upload first_cookbook</span><br></pre></td></tr></table></figure><p>上传之后来查看服务器的 cookbook 列表，列出 cookbook:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">first_cookbook   0.1.0</span><br></pre></td></tr></table></figure><p>可以看到 cookbook 已经成功上传，现在在服务器配置节点的运行。</p><h2 id="服务器前台管理"><a href="#服务器前台管理" class="headerlink" title="服务器前台管理"></a>服务器前台管理</h2><p>在 Chef Server 安装搭建好之后，默认不提供图形界面的前台管理功能，若要使用前台管理我们的 cookbook 以及节点信息，需要安装 Chef Server 的前台界面。执行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl install chef-manage</span><br></pre></td></tr></table></figure><p>重新配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-server-ctl reconfigure</span><br></pre></td></tr></table></figure><p>随后配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chef-manage-ctl reconfigure</span><br></pre></td></tr></table></figure><h3 id="管理-Run-List"><a href="#管理-Run-List" class="headerlink" title="管理 Run List"></a>管理 Run List</h3><p>打开前台，默认启用 ssl，所以开放了 Chef Server 的 443 端口。</p><p>打开 <code>https://192.168.221.89</code>，可以看到登陆页面，使用管理员登陆。登陆后可以看到节点信息：</p><p><img src="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-1.png"></p><p>然后来编辑节点，配置节点的 Run List:</p><p>找到节点配置：</p><p><img src="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-2.png"></p><p>配置 Run List:</p><p><img src="https://rainylog-1256215078.cos.ap-shanghai.myqcloud.com/images/chef-server-manage-3.png"></p><p>将我们的 cookbook 从 Avaliable Recipes 拖到 Current Run List 内。</p><p>在 Chef Workstation 中执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife ssh chef-client.geekrainy.local &#x27;chef-client&#x27; -m -x root -P passowrd</span><br></pre></td></tr></table></figure><p>可以看到输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">[root@chef-dk chef-repo]# knife ssh chef-client.geekrainy.local &#x27;chef-client&#x27; -m -x root -P 940911</span><br><span class="line">chef-client.geekrainy.local Starting Chef Client, version 13.6.4</span><br><span class="line">chef-client.geekrainy.local resolving cookbooks for run list: [&quot;first_cookbook&quot;]</span><br><span class="line">chef-client.geekrainy.local Synchronizing Cookbooks:</span><br><span class="line">chef-client.geekrainy.local   - first_cookbook (0.1.0)</span><br><span class="line">chef-client.geekrainy.local Installing Cookbook Gems:</span><br><span class="line">chef-client.geekrainy.local Compiling Cookbooks...</span><br><span class="line">chef-client.geekrainy.local Converging 7 resources</span><br><span class="line">chef-client.geekrainy.local Recipe: first_cookbook::default</span><br><span class="line">chef-client.geekrainy.local   * file[/root/test.txt] action create</span><br><span class="line">chef-client.geekrainy.local     - create new file /root/test.txt</span><br><span class="line">chef-client.geekrainy.local     - update content in file /root/test.txt from none to 48a12b</span><br><span class="line">chef-client.geekrainy.local     --- /root/test.txt	2017-12-27 17:33:34.259758283 +0800</span><br><span class="line">chef-client.geekrainy.local     +++ /root/.chef-test20171227-8105-1u3f11.txt	2017-12-27 17:33:34.258758279 +0800</span><br><span class="line">chef-client.geekrainy.local     @@ -1 +1,2 @@</span><br><span class="line">chef-client.geekrainy.local     +This file was created by Chef!</span><br><span class="line">chef-client.geekrainy.local     - restore selinux security context</span><br><span class="line">chef-client.geekrainy.local   * yum_package[pcre-devel] action install</span><br><span class="line">chef-client.geekrainy.local     - install version 8.32-17.el7 of package pcre-devel</span><br><span class="line">chef-client.geekrainy.local   * yum_package[openssl] action install (up to date)</span><br><span class="line">chef-client.geekrainy.local   * yum_package[openssl-devel] action install</span><br><span class="line">chef-client.geekrainy.local     - install version 1.0.2k-8.el7 of package openssl-devel</span><br><span class="line">chef-client.geekrainy.local   * cookbook_file[/etc/init.d/nginx] action create</span><br><span class="line">chef-client.geekrainy.local     - create new file /etc/init.d/nginx</span><br><span class="line">chef-client.geekrainy.local     - update content in file /etc/init.d/nginx from none to 0bc460</span><br><span class="line">chef-client.geekrainy.local     --- /etc/init.d/nginx	2017-12-27 17:35:32.489219470 +0800</span><br><span class="line">chef-client.geekrainy.local     +++ /etc/init.d/.chef-nginx20171227-8105-19448uh	2017-12-27 17:35:32.488219466 +0800</span><br><span class="line">chef-client.geekrainy.local     @@ -1 +1,56 @@</span><br><span class="line">chef-client.geekrainy.local     +#!/bin/bash</span><br><span class="line">chef-client.geekrainy.local     +#chkconfig: 345 86 16</span><br><span class="line">chef-client.geekrainy.local     +start()&#123;</span><br><span class="line">chef-client.geekrainy.local     +if [ -f /var/lock/subsys/tengine.lock ];then</span><br><span class="line">chef-client.geekrainy.local     +  echo &quot;Tengine is already running: [ FAILED ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +else</span><br><span class="line">chef-client.geekrainy.local     +  if /usr/local/nginx/sbin/nginx ;then</span><br><span class="line">chef-client.geekrainy.local     +    echo &quot;Starting tengine: [ OK ]&quot; </span><br><span class="line">chef-client.geekrainy.local     +    touch /var/lock/subsys/tengine.lock</span><br><span class="line">chef-client.geekrainy.local     +  else</span><br><span class="line">chef-client.geekrainy.local     +    echo &quot;Starting tengine: [ FAILED ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +  fi</span><br><span class="line">chef-client.geekrainy.local     +fi</span><br><span class="line">chef-client.geekrainy.local     +&#125;</span><br><span class="line">chef-client.geekrainy.local     +stop()&#123;</span><br><span class="line">chef-client.geekrainy.local     +if [ -f /var/lock/subsys/tengine.lock  ];then</span><br><span class="line">chef-client.geekrainy.local     + if /usr/local/nginx/sbin/nginx -s quit ;then</span><br><span class="line">chef-client.geekrainy.local     +   echo &quot;Stopping tengine: [ OK ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +   rm -rf /var/lock/subsys/tengine.lock</span><br><span class="line">chef-client.geekrainy.local     + else</span><br><span class="line">chef-client.geekrainy.local     +   echo &quot;Stopping tengine: [ FAILED ]&quot;</span><br><span class="line">chef-client.geekrainy.local     + fi</span><br><span class="line">chef-client.geekrainy.local     +else</span><br><span class="line">chef-client.geekrainy.local     + echo &quot;Tengine not runing: [ FAILED ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +fi</span><br><span class="line">chef-client.geekrainy.local     +&#125;</span><br><span class="line">chef-client.geekrainy.local     +reload()&#123;</span><br><span class="line">chef-client.geekrainy.local     +if /usr/local/nginx/sbin/nginx -s reload ;then</span><br><span class="line">chef-client.geekrainy.local     +  echo &quot;Reload tengine: [ OK ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +else</span><br><span class="line">chef-client.geekrainy.local     +  echo &quot;Reload tengine: [ FAILED ]&quot;</span><br><span class="line">chef-client.geekrainy.local     +fi</span><br><span class="line">chef-client.geekrainy.local     +&#125;</span><br><span class="line">chef-client.geekrainy.local     +case $1 in</span><br><span class="line">chef-client.geekrainy.local     +&quot;start&quot;)</span><br><span class="line">chef-client.geekrainy.local     + start</span><br><span class="line">chef-client.geekrainy.local     +;;</span><br><span class="line">chef-client.geekrainy.local     +&quot;stop&quot;)</span><br><span class="line">chef-client.geekrainy.local     + stop</span><br><span class="line">chef-client.geekrainy.local     +;;</span><br><span class="line">chef-client.geekrainy.local     +&quot;restart&quot;)</span><br><span class="line">chef-client.geekrainy.local     + stop</span><br><span class="line">chef-client.geekrainy.local     + sleep 1</span><br><span class="line">chef-client.geekrainy.local     + start</span><br><span class="line">chef-client.geekrainy.local     +;;</span><br><span class="line">chef-client.geekrainy.local     +&quot;reload&quot;)</span><br><span class="line">chef-client.geekrainy.local     + reload</span><br><span class="line">chef-client.geekrainy.local     +;;</span><br><span class="line">chef-client.geekrainy.local     +&quot;status&quot;)</span><br><span class="line">chef-client.geekrainy.local     + s=`pidof -s nginx`</span><br><span class="line">chef-client.geekrainy.local     + [ &quot;$s&quot; ] &amp;&amp; echo &quot;Tengine(nginx) pid $s running!!&quot; || echo &quot;Tengine（nginx） not runging!&quot;</span><br><span class="line">chef-client.geekrainy.local     +;;</span><br><span class="line">chef-client.geekrainy.local     +*)</span><br><span class="line">chef-client.geekrainy.local     +echo &quot;usage: $0 start|stop|restart|reload|status&quot;</span><br><span class="line">chef-client.geekrainy.local     +esac</span><br><span class="line">chef-client.geekrainy.local     - change mode from &#x27;&#x27; to &#x27;0755&#x27;</span><br><span class="line">chef-client.geekrainy.local     - change owner from &#x27;&#x27; to &#x27;root&#x27;</span><br><span class="line">chef-client.geekrainy.local     - change group from &#x27;&#x27; to &#x27;root&#x27;</span><br><span class="line">chef-client.geekrainy.local     - restore selinux security context</span><br><span class="line">chef-client.geekrainy.local   * script[install_tengine] action run</span><br><span class="line">chef-client.geekrainy.local     - execute &quot;bash&quot;  &quot;/tmp/chef-script20171227-8105-irvw5g&quot;</span><br><span class="line">chef-client.geekrainy.local   * service[nginx] action start</span><br><span class="line">chef-client.geekrainy.local     - start service service[nginx]</span><br><span class="line">chef-client.geekrainy.local </span><br><span class="line">chef-client.geekrainy.local Running handlers:</span><br><span class="line">chef-client.geekrainy.local Running handlers complete</span><br><span class="line">chef-client.geekrainy.local Chef Client finished, 6/7 resources updated in 03 minutes 21 seconds</span><br></pre></td></tr></table></figure><p>执行完成即可创建成功，在 Chef Client 中执行验证：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx status</span><br></pre></td></tr></table></figure><p>看到输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tengine(nginx) pid 23776 running!!</span><br></pre></td></tr></table></figure><p>证明已经部署成功。</p><h2 id="命令行运行"><a href="#命令行运行" class="headerlink" title="命令行运行"></a>命令行运行</h2><p>除了在 Chef Server 前台管理外，还可在 Chef Workstation 内使用命令行来管理 Run List。</p><p>查看 Node 的状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@chef-dk chef-repo]# knife node show chef-client.geekrainy.local</span><br><span class="line">Node Name:   chef-client.geekrainy.local</span><br><span class="line">Environment: _default</span><br><span class="line">FQDN:        chef-client.geekrainy.local</span><br><span class="line">IP:          192.168.221.91</span><br><span class="line">Run List:    </span><br><span class="line">Roles:       </span><br><span class="line">Recipes:     first_cookbook, first_cookbook::default</span><br><span class="line">Platform:    centos 7.3.1611</span><br><span class="line">toc: true</span><br><span class="line">tags:        </span><br></pre></td></tr></table></figure><p>这里看到 Run List 为空，接下来将我们的 cookbook 添加到 Run List，我们定义了默认的 Recipes: default，因而添加 cookbook 实际上执行的就是 cookbook 中的 default recipes。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@chef-dk chef-repo]# knife node run_list add chef-client.geekrainy.local recipe[first_cookbook]</span><br><span class="line">chef-client.geekrainy.local:</span><br><span class="line">  run_list: recipe[first_cookbook]</span><br></pre></td></tr></table></figure><p>再次查看状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@chef-dk chef-repo]# knife node show chef-client.geekrainy.local</span><br><span class="line">Node Name:   chef-client.geekrainy.local</span><br><span class="line">Environment: _default</span><br><span class="line">FQDN:        chef-client.geekrainy.local</span><br><span class="line">IP:          192.168.221.91</span><br><span class="line">Run List:    recipe[first_cookbook]</span><br><span class="line">Roles:       </span><br><span class="line">Recipes:     first_cookbook, first_cookbook::default</span><br><span class="line">Platform:    centos 7.3.1611</span><br><span class="line">toc: true</span><br><span class="line">tags:        </span><br></pre></td></tr></table></figure><p>就成功添加了一个 Run List。</p><h3 id="编辑-node-配置文件"><a href="#编辑-node-配置文件" class="headerlink" title="编辑 node 配置文件"></a>编辑 node 配置文件</h3><p>通过编辑 node 配置文件，也可以编辑 Run List。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife node edit chef-client.geekrainy.local</span><br></pre></td></tr></table></figure><p>执行后可能报错：</p><blockquote><p>ERROR: You must set your EDITOR environment variable or configure your editor via knife.rb</p></blockquote><p>配置环境变量可以解决：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &quot;EDITOR=vim&quot;</span><br></pre></td></tr></table></figure><p>再次执行后可以编辑 JSON 格式的节点信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;chef-client.geekrainy.local&quot;,</span><br><span class="line">  &quot;chef_environment&quot;: &quot;_default&quot;,</span><br><span class="line">  &quot;normal&quot;: &#123;</span><br><span class="line">    &quot;tags&quot;: [</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;policy_name&quot;: null,</span><br><span class="line">  &quot;policy_group&quot;: null,</span><br><span class="line">  &quot;run_list&quot;: [</span><br><span class="line">  &quot;recipe[first_cookbook]&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于 Knife 和 Run List 的更多信息可以参考：</p><ul><li>Run List: <a target="_blank" rel="noopener" href="https://docs.chef.io/run_lists.html">https://docs.chef.io/run_lists.html</a></li><li>Knife <a target="_blank" rel="noopener" href="https://docs.chef.io/knife_node.html">https://docs.chef.io/knife_node.html</a></li></ul><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>上文介绍了通过 Chef Server 的前台界面和命令行对节点的 Run List 进行管理，并且可以成功执行我们的 “烹饪”操作，但这两种方法都有不便之处。用前台界面管理虽然直观但管理更多节点时效率低，命令行也显得繁琐并且容易进行误操作。在执行 <code>kinfe bootstrap</code> 的过程中，也可以用编辑好的 json 文件进行节点的初始化：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">knife bootstrap localhost -p 2200 -N ubuntu-12.04 -r &#x27;role[group1]&#x27; --ssh-user vagrant --sudo --bootstrap-vault-file sea-power-bootstrap-vault-file.json</span><br></pre></td></tr></table></figure><p>上述为官网示例，在 json 中去定义和编辑，是一种较为可靠的定义节点的方式。</p><p>到这里，就简单的完成了从构建节点，到创建 cookbook，到测试发布的过程。然而，这里的示例存在很多不足，不具有较强的普适性，扩展和管理都很不便。接下来将配置一个较为完善的 cookbook，来探索一些较为优雅的实践方式。</p><p>-EOF-</p><div class="article-copyright"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external"><span class="icon icon-creative-commons"></span> <span>本博客所有文章除特别声明外，均采用 CC BY-NC-ND 4.0 许可协议。转载请注明出处！</span> </a><a href="https://rainylog.com">&copy; 雨落</a></div></div><div class="article-tags"><a class="tag-none-link" href="/tags/Chef/" rel="tag">Chef</a><a class="tag-none-link" href="/tags/DevOps/" rel="tag">DevOps</a></div><nav class="article-nav clearfix"><a href="/post/2017-2018/" class="article-nav-newer"><div class="article-nav-title">2017 年终总结</div></a><a href="/post/chef-tutorial-2/" class="article-nav-older"><div class="article-nav-title">Chef 自动化运维：初探 cookbook</div></a></nav><section id="comments" class="white-box"></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="https://rainylog.com">雨落</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a target="_blank" href="https://hexo.io/" rel="external noopener">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix show" style="display:block"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc show" style="display:block"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-cookbook"><span class="toc-number">1.</span> <span class="toc-text">上传 cookbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%89%8D%E5%8F%B0%E7%AE%A1%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">服务器前台管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86-Run-List"><span class="toc-number">2.1.</span> <span class="toc-text">管理 Run List</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BF%90%E8%A1%8C"><span class="toc-number">3.</span> <span class="toc-text">命令行运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91-node-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">编辑 node 配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-number">4.</span> <span class="toc-text">扩展</span></a></li></ol></div><div class="site-bio" style="display:none"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.gif"></div><div class="info"><a class="name dark-btn" href="/about">Rainy</a></div><div class="info"><span class="item desc">沉淀，分享。</span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto://geekrainy@gmail.com" class="email" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/geekrainy" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://weibo.com/geekrainy" class="weibo" target="_blank" rel="external"><span class="icon icon-weibo"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="rainylog",AZURE_INDEX_NAME="rainylog",AZURE_QUERY_KEY="FDEE6CFE3AB9A25E574BBCB873B29595",BAIDU_API_ID="",SEARCH_SERVICE="azure"</script><script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!0,notify:!0,appId:"H90zpiwhe0XxV8Kb8n6BplHo-MdYXbMMI",appKey:"974axFeQbAqLnxwJIRgc1xHa",placeholder:"Just go go",avatar:"retro",meta:guest,pageSize:10,visitor:!0})</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>