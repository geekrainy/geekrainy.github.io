<!DOCTYPE html><html><head><meta charset="utf-8"><title>React 开发环境配置 | 雨落</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="create-react-app使用官方提供的 create-react-app 来生成初始化脚手架。 1create-react-app demo  添加 stylus 支持（这里添加 stylus 支持是因为之前的老代码使用过 stylus，同理可添加 less 和 scss 支持） create-react-app 当前使用的最新版本为 1.5.2，添加 stylus 需要执行如下操作： 1"><meta property="og:type" content="article"><meta property="og:title" content="React 开发环境配置"><meta property="og:url" content="https://rainylog.com/post/react-dev-env/index.html"><meta property="og:site_name" content="雨落"><meta property="og:description" content="create-react-app使用官方提供的 create-react-app 来生成初始化脚手架。 1create-react-app demo  添加 stylus 支持（这里添加 stylus 支持是因为之前的老代码使用过 stylus，同理可添加 less 和 scss 支持） create-react-app 当前使用的最新版本为 1.5.2，添加 stylus 需要执行如下操作： 1"><meta property="og:locale"><meta property="article:published_time" content="2018-04-24T01:33:37.000Z"><meta property="article:modified_time" content="2020-12-29T13:35:51.529Z"><meta property="article:author" content="Rainy"><meta property="article:tag" content="前端"><meta property="article:tag" content="React"><meta name="twitter:card" content="summary"><link rel="icon" href="/favicon.png"><link href="https://fonts.googleapis.com/css?family=Crimson+Text" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99171848-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-99171848-1")</script><link rel="stylesheet" href="/icomoon/style.css"><link rel="stylesheet" href="/style.css"><meta name="generator" content="Hexo 5.1.0"><link rel="alternate" href="/atom.xml" title="雨落" type="application/atom+xml">
</head><body><div class="site-wrapper"><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>document.getElementById("loading-bar").style.width="20%"</script><header id="header" class="site-header clearfix"><a class="logo square clearfix" href="/"><span class="b">雨 </span><span class="b">落 </span></a><a class="me square site-nav-switch clearfix"><span class="b"><span class="icon icon-menu"></span></span></a></header><script>document.getElementById("loading-bar").style.width="40%"</script><main id="main" class="clearfix"><article id="post-react-dev-env" class="article white-box article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="article-title" itemprop="name">React 开发环境配置</h1><div class="article-meta">Posted on <time class="article-time" datetime="2018-04-24T01:33:37.000Z" itemprop="datePublished">Apr 24, 2018</time></div></header><div class="article-entry" itemprop="articleBody"><h2 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create-react-app"></a>create-react-app</h2><p>使用官方提供的 create-react-app 来生成初始化脚手架。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app demo</span><br></pre></td></tr></table></figure><h2 id="添加-stylus-支持"><a href="#添加-stylus-支持" class="headerlink" title="添加 stylus 支持"></a>添加 stylus 支持</h2><p>（这里添加 stylus 支持是因为之前的老代码使用过 stylus，同理可添加 less 和 scss 支持）</p><p>create-react-app 当前使用的最新版本为 1.5.2，添加 stylus 需要执行如下操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev stylus stylus-loader</span><br></pre></td></tr></table></figure><p>随后执行 <code>yarn run eject</code> 弹出配置。</p><p>弹出配置后，执行 <code>yarn</code> 安装剩余所需依赖包。</p><p>在弹出的配置中，配置 <code>config/webpack.config.dev.js</code>，找到如下部分：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">oneOf: [</span><br><span class="line">  <span class="comment">// &quot;url&quot; loader works like &quot;file&quot; loader except that it embeds assets</span></span><br><span class="line">  <span class="comment">// smaller than specified limit in bytes as data URLs to avoid requests.</span></span><br><span class="line">  <span class="comment">// A missing `test` is equivalent to a match.</span></span><br><span class="line">  &#123;</span><br><span class="line">    test: [<span class="regexp">/\.bmp$/</span>, <span class="regexp">/\.gif$/</span>, <span class="regexp">/\.jpe?g$/</span>, <span class="regexp">/\.png$/</span>],</span><br><span class="line">    loader: <span class="built_in">require</span>.resolve(<span class="string">&#x27;url-loader&#x27;</span>),</span><br><span class="line">    options: &#123;</span><br><span class="line">      limit: <span class="number">10000</span>,</span><br><span class="line">      name: <span class="string">&#x27;static/media/[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>在其下添加 stylus 的配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">oneOf: [</span><br><span class="line">  <span class="comment">// &quot;url&quot; loader works like &quot;file&quot; loader except that it embeds assets</span></span><br><span class="line">  <span class="comment">// smaller than specified limit in bytes as data URLs to avoid requests.</span></span><br><span class="line">  <span class="comment">// A missing `test` is equivalent to a match.</span></span><br><span class="line">  &#123;</span><br><span class="line">    test: [<span class="regexp">/\.bmp$/</span>, <span class="regexp">/\.gif$/</span>, <span class="regexp">/\.jpe?g$/</span>, <span class="regexp">/\.png$/</span>],</span><br><span class="line">    loader: <span class="built_in">require</span>.resolve(<span class="string">&#x27;url-loader&#x27;</span>),</span><br><span class="line">    options: &#123;</span><br><span class="line">      limit: <span class="number">10000</span>,</span><br><span class="line">      name: <span class="string">&#x27;static/media/[name].[hash:8].[ext]&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Process Stylus with Babel.</span></span><br><span class="line">  &#123;</span><br><span class="line">    test: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">      <span class="built_in">require</span>.resolve(<span class="string">&#x27;style-loader&#x27;</span>),</span><br><span class="line">      <span class="built_in">require</span>.resolve(<span class="string">&#x27;css-loader&#x27;</span>),</span><br><span class="line">      <span class="built_in">require</span>.resolve(<span class="string">&#x27;stylus-loader&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Process JS with Babel.</span></span><br></pre></td></tr></table></figure><p>识别 .styl 后缀加载 stylus-loader。</p><h2 id="支持装饰器配置"><a href="#支持装饰器配置" class="headerlink" title="支持装饰器配置"></a>支持装饰器配置</h2><p>由于使用 MobX 来进行状态管理，虽然也有不适用装饰器的写法，但是官方推荐使用装饰器，因而接下来添加装饰器支持。</p><p>安装依赖支持：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev babel-preset-stage-2 babel-plugin-transform-decorators-legacy</span><br></pre></td></tr></table></figure><p>在 <code>config/webpack.config.dev.js</code> 找到如下部分：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Process JS with Babel.</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(js|jsx|mjs)$/</span>,</span><br><span class="line">  include: paths.appSrc,</span><br><span class="line">  loader: <span class="built_in">require</span>.resolve(<span class="string">&#x27;babel-loader&#x27;</span>),</span><br><span class="line">  options: &#123;</span><br><span class="line">    babelrc: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// This is a feature of `babel-loader` for webpack (not Babel itself).</span></span><br><span class="line">    <span class="comment">// It enables caching results in ./node_modules/.cache/babel-loader/</span></span><br><span class="line">    <span class="comment">// directory for faster rebuilds.</span></span><br><span class="line"></span><br><span class="line">    presets: [<span class="built_in">require</span>.resolve(<span class="string">&#x27;babel-preset-stage-2&#x27;</span>), <span class="built_in">require</span>.resolve(<span class="string">&#x27;babel-preset-react-app&#x27;</span>)],</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="built_in">require</span>.resolve(<span class="string">&#x27;babel-plugin-transform-decorators-legacy&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">    cacheDirectory: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>即可，另外一种方式是将配置写在 <code>.babelrc</code> 配置文件中，需要将上述配置中的 <code>babelrc: false</code> 改为 <code>babelrc: true</code>。下面的 presets 和 plugins 都可以去掉。</p><p>在项目根目录新建一个 <code>.babelrc</code> 配置文件，在其中写入：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;babel-preset-stage-2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-preset-react-app&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;transform-decorators-legacy&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即可启用。</p><h2 id="配置按需引入"><a href="#配置按需引入" class="headerlink" title="配置按需引入"></a>配置按需引入</h2><p>使用 antd 或者使用 antd-mobile 时，引入模块需要同时引入样式文件，配置按需引入会将组件需要的样式自动引入，无需手动引入。</p><p>安装插件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-plugin-import</span><br></pre></td></tr></table></figure><p>在上述配置的 babel 中，plugins 新增：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;presets&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;babel-preset-stage-2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-preset-react-app&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;transform-decorators-legacy&quot;</span>,</span><br><span class="line">    [<span class="string">&quot;import&quot;</span>, &#123; <span class="attr">&quot;libraryName&quot;</span>: <span class="string">&quot;antd-mobile&quot;</span>, <span class="attr">&quot;style&quot;</span>: <span class="string">&quot;css&quot;</span> &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意 <code>transform-decorators-legacy</code> 需要保持在插件第一个。</p><p>libraryName 为需要引入的库的名称。</p><h2 id="配置模块热替换-HMR"><a href="#配置模块热替换-HMR" class="headerlink" title="配置模块热替换(HMR)"></a>配置模块热替换(HMR)</h2><p>顾名思义，webpack 启动的 server 会根据修改自动刷新页面，但有时往往修改的只是一个小模块，因而实现模块的局部刷新可以提高开发效率，也可以避免全局刷新对某些情景下的调试。</p><p>在 <code>src/index.js</code> 中，添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider &#123;...stores&#125;&gt;</span><br><span class="line">    &lt;App /&gt; </span><br><span class="line">  &lt;/Provider&gt;</span><br><span class="line">,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被添加的部分</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure><p>-EOF-</p><div class="article-copyright"><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external"><span class="icon icon-creative-commons"></span> <span>本博客所有文章除特别声明外，均采用 CC BY-NC-ND 4.0 许可协议。转载请注明出处！</span> </a><a href="https://rainylog.com">&copy; 雨落</a></div></div><div class="article-tags"><a class="tag-none-link" href="/tags/React/" rel="tag">React</a><a class="tag-none-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></div><nav class="article-nav clearfix"><a href="/post/zhi-xiang-shu/" class="article-nav-newer"><div class="article-nav-title">致橡树</div></a><a href="/post/oracle-rac-backup/" class="article-nav-older"><div class="article-nav-title">Oracle RAC 备份方式</div></a></nav><section id="comments" class="white-box"></section></article><script>document.getElementById("loading-bar").style.width="60%"</script></main><footer id="footer" class="clearfix"><div class="search"><form name="searchform" id="searchform" class="u-search-form"><input type="text" id="searchinput" class="u-search-input st-default-search-input" data-list-highlight="true" data-list-value-completion="true" placeholder="Looking for something?"> <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit"><span class="icon icon-search"></span></button></form></div><div>&copy; <a href="https://rainylog.com">雨落</a> Theme by <a href="http://artifact.me/" target="_blank">Art Chen</a>.</div><div>Powered by <a target="_blank" href="https://hexo.io/" rel="external noopener">Hexo</a>.</div></footer><script>document.getElementById("loading-bar").style.width="80%"</script><div class="overlay"></div></div><div class="site-sidebar"><div class="sidebar-switch clearfix show" style="display:block"><a class="dark-btn active" data-toggle="toc"><span class="icon icon-list"></span> <span class="text">Index</span> </a><a class="dark-btn" data-toggle="bio"><span class="icon icon-person"></span> <span class="text">Bio</span></a></div><div class="site-toc show" style="display:block"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#create-react-app"><span class="toc-number">1.</span> <span class="toc-text">create-react-app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-stylus-%E6%94%AF%E6%8C%81"><span class="toc-number">2.</span> <span class="toc-text">添加 stylus 支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E8%A3%85%E9%A5%B0%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">支持装饰器配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8C%89%E9%9C%80%E5%BC%95%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">配置按需引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2-HMR"><span class="toc-number">5.</span> <span class="toc-text">配置模块热替换(HMR)</span></a></li></ol></div><div class="site-bio" style="display:none"><div class="about-me clearfix"><div class="avatar"><img src="/img/avatar.gif"></div><div class="info"><a class="name dark-btn" href="/about">Rainy</a></div><div class="info"><span class="item desc">沉淀，分享。</span></div></div><div class="social clearfix"><a href="/atom.xml" class="feed" target="_blank" rel="external"><span class="icon icon-feed"></span> </a><a href="mailto://geekrainy@gmail.com" class="email" target="_blank" rel="external"><span class="icon icon-mail"></span> </a><a href="https://github.com/geekrainy" class="github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="https://weibo.com/geekrainy" class="weibo" target="_blank" rel="external"><span class="icon icon-weibo"></span></a></div><div class="shortcuts clearfix"><div class="bk"><a href="#header" class="dark-btn window-nav"><span class="icon icon-chevron-thin-up"></span> <span class="text">Back to Top</span></a></div><div class="bk"><a href="#footer" class="dark-btn window-nav"><span class="icon icon-chevron-thin-down"></span> <span class="text">Go to Bottom</span></a></div></div></div></div><script type="text/javascript">var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="rainylog",AZURE_INDEX_NAME="rainylog",AZURE_QUERY_KEY="FDEE6CFE3AB9A25E574BBCB873B29595",BAIDU_API_ID="",SEARCH_SERVICE="azure"</script><script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="/js/jquery.js"><\/script>')</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script type="text/javascript">var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!0,notify:!0,appId:"H90zpiwhe0XxV8Kb8n6BplHo-MdYXbMMI",appKey:"974axFeQbAqLnxwJIRgc1xHa",placeholder:"Just go go",avatar:"retro",meta:guest,pageSize:10,visitor:!0})</script><script>document.getElementById("loading-bar").style.width="100%"</script></body></html>